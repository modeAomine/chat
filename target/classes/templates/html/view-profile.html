<!DOCTYPE html>
<html lang="en" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<title th:text="'Profile ' + ${viewuser.username}"></title>
<head th:replace="~{fragments/head :: head}">
</head>
<style>
    .dark-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -1;
        background-color: rgba(0, 0, 0, 0.5);
        overflow: hidden;
    }

    .profile-avatar {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .user-news {
        margin-top: 20px;
    }

    .user-news p {
        background-color: #333;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
        color: white;
    }
</style>
<body>
<header th:replace="~{fragments/header :: header}"></header>
<div class="container-profile mt-5">
    <div class="profile-container row justify-content-center">
        <div class="col-md-3 profile-avatar-container" style="margin-right: 15px;">
            <div class="profile-avatar-block" style="width: 230px; background-color: #333333D8;">
                <div class="avatar-container" style="width: 200px; height: 200px; border-radius: 50%; overflow: hidden;">
                    <img class="profile-avatar" id="avatarImage"
                         rel="icon" th:src="@{'/uploads/' + ${viewuser.filename}}"
                         alt="avatar" style="width: 100%;
                height: 100%;
                object-fit: cover;"
                         type="image/x-icon">
                </div>
                <div style="margin-top: 10px;">
                    <form method="post" th:action="'/sub/' + ${user.getId()} + '/to/' + ${viewuser.id}">
                        <button type="submit">Подписаться</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="profile-info-block text-white">
            <div class="profile-details text-center mt-3">
                <div class="user-info">
                    <span class="user-login" th:text="${viewuser.username}">john.doe</span>
                    <span class="last-active-time" th:text="${#dates.format(viewuser.lastActive, 'dd-MM-yyyy HH:mm:ss')}">N/A</span>
                    <span th:if="${isUserOnline}">Пользователь в сети</span>
                    <span th:unless="${isUserOnline}">Пользователь не в сети</span>
                </div>
                <hr class="separator-line mb-4">
                <nav class="nav flex-column mt-3">
                    <p class="card-info">Дата регистрации: <span th:text="${#dates.format(viewuser.registrationDate, 'dd-MM-yyyy')}">00-00-0000</span>
                    </p>
                    <p class="card-text" th:if="${viewuser.name != null && !viewuser.name.isBlank() && !viewuser.name.isEmpty()}">Имя:
                        <span th:each="name : ${viewuser.name}">
              <span th:text="${viewuser.name}"></span>
            </span>
                    </p>
                    <p class="block-info" th:if="${viewuser.email != null && !viewuser.email.isBlank() && !viewuser.email.isEmpty()}">Email:
                        <span th:each="email : ${viewuser.email}">
              <span th:text="${viewuser.email}"></span>
            </span>
                    </p>
                    <p class="block-info" th:if="${viewuser.discord != null && !viewuser.discord.isBlank() && !viewuser.discord.isEmpty()}">Discord:
                        <span th:each="discord : ${viewuser.discord}">
              <span th:text="${viewuser.discord}"></span>
            </span>
                    </p>
                    <p class="block-info" th:if="${viewuser.VK != null && !viewuser.VK.isBlank() && !viewuser.VK.isEmpty()}">VK:
                        <span th:each="VK : ${viewuser.VK}">
              <link th:text="${viewuser.VK}">
            </span>
                    </p>
                </nav>
                <hr class="separator-line my-4">
            </div>
        </div>
        <div class="news-block">
            <h4 class="text-white">Публикация новости</h4>
            <form th:action="@{/profile/publishNews}" method="post">
                <div class="form-group">
                    <label for="newsContent" style="color: white">Текст новости:</label>
                    <input type="hidden" name="userId" th:value="${viewuser.getId()}">
                    <textarea class="form-control" id="newsContent" name="newsContent" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-custom">Опубликовать новость</button>
            </form>
            <ul th:if="${viewuser.publishNewsProfile != null}" class="user-news-list">
                <li th:each="news, iterStat : ${viewuser.publishNewsProfile}"
                    style="background-color: #3b3b3b;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            margin-top: 20px;
            color: white">
                    <div class="news-author"
                         style="display: flex;
                align-items: center;
                margin-bottom: 10px;">
                        <img th:src="@{'/uploads/' + ${news.userId.filename}}" class="profile-avatar" alt="avatar"
                             style="width: 50px;
                    height: 50px;
                    object-fit: cover;
                    border-radius: 50%;">
                        <span th:text="${news.userId.username}" class="author-username" style="margin-left: 10px;"></span>
                    </div>
                    <hr class="news-divider" style="margin-bottom: 10px;"/>
                    <p th:text="${news.content}" class="news-content"></p>
                    <ul>
                        <li th:each="comment : ${news.commentsNews}">
        <span>
            <img th:src="@{'/uploads/' + ${comment.userId.filename}}" style="
                height: 40px;
                width: 40px;
                object-fit: cover;
                border-radius: 50%;">
        </span>
                            <span>
            <a th:if="${#authentication.name == comment.userId.username}"
               th:href="@{'/profile'}"
               th:text="${comment.userId.username}"></a>
            <a th:if="${#authentication.name != comment.userId.username}"
               th:href="@{'/profile/' + ${comment.userId.username}}"
               th:text="${comment.userId.username}"></a>
        </span>:
                            <span th:text="${comment.content}"></span>
                            <hr class="separator-line my-4">
                        </li>
                    </ul>
                    <div class="news-icons" style="display: flex; align-items: center; margin-top: 10px;">
            <span style="margin-right: 10px;">
            <img class="image" id="likeImage" rel="icon" th:src="@{/img/like.svg}"
                 style="width: 35px;
                  height: 35px;
                  margin-top: 10px;"
                 type="image/x-icon">
            </span>
                        <span class="cursor-pointer" data-toggle="collapse" data-target="#commentField${news.id}">
              <img class="image" id="commentImage"
                   rel="icon" th:src="@{/img/comments.svg}" style="
                        width: 35px;
                        height: 35px;"
                   type="image/x-icon">
            </span>
                    </div>
                    <div data-comment-id="commentField" class="collapse" style="margin-top: 10px;">
                        <form class="comment-form" action="/comments/{newsId}" method="post" th:action="@{'/comments/' + ${news.id}}" th:object="${comment}">
                            <input type="hidden" name="newsId" th:value="${news.getId()}">
                            <div class="form-group">
                                <label for="commentContent">Оставьте комментарий:</label>
                                <input type="text" id="commentContent" name="content" class="form-control" placeholder="Оставьте комментарий..." required>
                            </div>
                            <button type="submit" class="btn btn-primary">Отправить</button>
                        </form>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="dark-overlay">
    <img class="profile-avatar" id="profileBackgroundFilename"
         rel="icon" th:src="@{'/uploads/' + ${viewuser.profileBackgroundFilename}}"
         alt="Background Image">
</div>
<div style="height: 100px"></div>
<footer th:replace="~{fragments/footer :: footer}"></footer>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
    $(document).ready(function() {
        $('.news-icons .cursor-pointer').click(function() {
            var commentField = $(this).closest('li').find('.collapse');
            commentField.collapse('toggle');
        });
    });
</script>
</body>
</html>
